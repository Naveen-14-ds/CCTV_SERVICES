<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Login - Smart CCTV</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .fade-in {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 1s ease forwards;
    }
    .fade-in-delayed {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 1.5s ease forwards;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card:hover {
      box-shadow: 0 8px 32px rgba(0,0,0,0.12) !important;
      transform: translateY(-4px) scale(1.02);
      transition: box-shadow 0.3s, transform 0.3s;
    }
    .btn:hover {
      filter: brightness(1.08);
      transition: filter 0.2s;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container vh-100 d-flex align-items-center justify-content-center fade-in">
    <div class="card shadow-lg border-0 p-4 fade-in-delayed" style="max-width:400px; width:100%;">
      <div class="text-center mb-4 fade-in">
        <i class="bi bi-camera-video display-5 text-primary"></i>
        <h3 class="fw-bold mt-2 mb-0">Smart CCTV Login</h3>
      </div>
      <div id="msg" class="fade-in-delayed"></div>
      <form id="loginForm">
        <div class="mb-3 fade-in-delayed">
          <label class="form-label">Email</label>
          <input type="email" id="email" class="form-control form-control-lg" placeholder="Enter your email" required>
        </div>
        <div class="mb-3 fade-in-delayed">
          <label class="form-label">Password</label>
          <input type="password" id="password" class="form-control form-control-lg" placeholder="Enter your password" required>
        </div>
        <button class="btn btn-primary btn-lg w-100 mt-2 fade-in-delayed">Login</button>
      </form>
      <p class="mt-4 text-center text-muted fade-in-delayed">No account? <a href="signup.html" class="text-primary fw-bold">Sign up</a></p>
    </div>
  </div>

<script>
// use backend API base
const API_BASE = "http://localhost:3001";
const api = API_BASE + "/api/auth/login";
const form = document.getElementById("loginForm");
const msg = document.getElementById("msg");
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  msg.innerHTML = "";
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  try {
    const res = await fetch(api, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ email, password })
    });
    // Safely parse response body (handle empty/non-JSON bodies)
    const _text = await res.text();
    let data;
    try { data = _text ? JSON.parse(_text) : {}; }
    catch (parseErr) { data = { message: _text }; }
    if (!res.ok) throw new Error(data.message || "Login failed");
    // store token + user
    localStorage.setItem("token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));
    window.location.href = data.user.role === "admin" ? "admin-dashboard.html" : "owner-dashboard.html";
  } catch (err) {
    // Log full error to console for debugging (network/CORS/mixed-content)
    console.error('Login fetch error:', err);
    const message = err && (err.message || String(err)) || 'Network error: failed to fetch';
    msg.innerHTML = `<div class="alert alert-danger">Request failed: ${message}</div>`;
  }
});
</script>
</body>
</html>
